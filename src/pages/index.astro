---
import MainLayout from '../layouts/MainLayout.astro';
import ServiceCard from '../components/ServiceCard.astro';

// API URL - use PORT env var for same-server setup
const API_URL = `http://localhost:${process.env.PORT || 3001}`;

// Fetch page content from API
let pageData = {
  heroTitle: 'Transform Your Home',
  heroSubtitle: 'Build Your Dreams',
  heroDescription: 'Transforming spaces into functional, modern, and durable places',
  heroImage: '/images/placeholders/hero-bg.png',
  whyChooseTitle: 'Why Choose Living Stone Contractors?',
  whyChooseDescription: 'We are passionate about every detail of the process, from planning to execution, ensuring high-quality results that reflect the style and needs of each client. Our approach combines technical expertise, premium materials, and reliable service.',
  feature1Title: 'Licensed & Insured',
  feature1Description: 'Fully licensed contractors with comprehensive insurance coverage',
  feature2Title: 'Transparent Pricing',
  feature2Description: 'No hidden fees. Clear estimates before we start',
  feature3Title: 'Expert Team',
  feature3Description: 'Skilled craftsmen with decades of combined experience'
};

let featuredServices = [];
let testimonials = [];
let contactInfo = {
  phone: '(202) 373-8568',
  email: 'lstonecontractors@gmail.com'
};

try {
  // Fetch page content
  const pagesRes = await fetch(`${API_URL}/api/pages`);
  if (pagesRes.ok) {
    const pagesData = await pagesRes.json();
    if (pagesData.home) {
      pageData = { ...pageData, ...pagesData.home };
    }
  }

  // Fetch services
  const servicesRes = await fetch(`${API_URL}/api/services`);
  if (servicesRes.ok) {
    const services = await servicesRes.json();
    featuredServices = services
      .filter((s: any) => s.featured)
      .sort((a: any, b: any) => a.order - b.order);
  }

  // Fetch testimonials
  const testimonialsRes = await fetch(`${API_URL}/api/testimonials`);
  if (testimonialsRes.ok) {
    testimonials = await testimonialsRes.json();
  }

  // Fetch contact info
  const contactRes = await fetch(`${API_URL}/api/contact`);
  if (contactRes.ok) {
    contactInfo = await contactRes.json();
  }
} catch (error) {
  console.error('Error fetching data from API:', error);
}
---

<MainLayout
  title="Living Stone Contractors, LLC - Home Remodeling & Improvement Specialists"
  description="Specialized in home remodeling and improvement, transforming spaces into functional, modern, and durable places. Technical expertise, premium materials, and reliable service."
>
  <!-- Hero Section -->
  <section class="relative h-screen min-h-[600px] flex items-center justify-center bg-secondary-900">
    <div class="absolute inset-0 bg-gradient-to-r from-black/70 to-black/50 z-10"></div>
    <div
      class="absolute inset-0 bg-cover bg-center"
      style={`background-image: url('${pageData.heroImage}');`}
    ></div>

    <div class="container-custom relative z-20 text-white text-center">
      <h1 class="font-heading font-bold mb-6">
        {pageData.heroTitle}<br />
        <span class="text-primary-400">{pageData.heroSubtitle}</span>
      </h1>
      <p class="text-xl md:text-2xl mb-8 max-w-3xl mx-auto">
        {pageData.heroDescription}
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="/contact" class="btn btn-primary text-lg px-8 py-4">
          Get Free Estimate
        </a>
        <a href={`tel:${contactInfo.phone?.replace(/[^0-9+]/g, '')}`} class="btn btn-outline text-lg px-8 py-4">
          Call Us Now
        </a>
      </div>
    </div>

    <!-- Scroll indicator -->
    <div class="absolute bottom-8 left-1/2 -translate-x-1/2 z-20 animate-bounce">
      <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
      </svg>
    </div>
  </section>

  <!-- About Section -->
  <section class="section-padding bg-white">
    <div class="container-custom">
      <div class="grid md:grid-cols-2 gap-12 items-center">
        <div>
          <h2 class="mb-6">{pageData.whyChooseTitle}</h2>
          <p class="text-lg text-gray-600 mb-6">
            {pageData.whyChooseDescription}
          </p>
          <div class="space-y-4">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-6 h-6 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <div>
                <h4 class="font-semibold mb-1">{pageData.feature1Title}</h4>
                <p class="text-gray-600">{pageData.feature1Description}</p>
              </div>
            </div>
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-6 h-6 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <div>
                <h4 class="font-semibold mb-1">{pageData.feature2Title}</h4>
                <p class="text-gray-600">{pageData.feature2Description}</p>
              </div>
            </div>
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-6 h-6 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
              </div>
              <div>
                <h4 class="font-semibold mb-1">{pageData.feature3Title}</h4>
                <p class="text-gray-600">{pageData.feature3Description}</p>
              </div>
            </div>
          </div>
        </div>
        <div class="relative text-center">
          <img
            src="/images/logos/LSC_principal con slogan_Color.png"
            alt="Living Stone Contractors"
            class="w-full max-w-md mx-auto"
          />
          <p class="text-sm text-gray-600 mt-2">License #165925</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Services Section -->
  <section class="section-padding bg-gray-50">
    <div class="container-custom">
      <div class="text-center mb-12">
        <h2 class="mb-4">Our Services</h2>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
          From interior renovations to complete exterior makeovers, we offer comprehensive
          home improvement services to meet all your needs.
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {featuredServices.map((service: any) => (
          <ServiceCard
            title={service.title}
            description={service.description}
            image={service.image}
            href={`/services/${service.slug}`}
            icon={service.icon}
          />
        ))}
      </div>

      <div class="text-center mt-12">
        <a href="/services" class="btn btn-primary text-lg">
          View All Services
        </a>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="section-padding bg-primary-600 text-white">
    <div class="container-custom">
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="mb-6">Ready to Start Your Project?</h2>
        <p class="text-xl mb-8 opacity-90">
          Get a free, no-obligation estimate today. Our team is ready to bring your vision to life.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href="/contact" class="btn bg-white text-primary-600 hover:bg-gray-100 text-lg px-8 py-4">
            Get Free Estimate
          </a>
          <a href={`tel:${contactInfo.phone?.replace(/[^0-9+]/g, '')}`} class="btn btn-outline border-white text-white hover:bg-white hover:text-primary-600 text-lg px-8 py-4">
            {contactInfo.phone}
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Testimonials Section -->
  <section class="section-padding bg-white">
    <div class="container-custom">
      <div class="text-center mb-12">
        <h2 class="mb-4">What Our Clients Say</h2>
        <p class="text-lg text-gray-600">Don't just take our word for it</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        {testimonials.length > 0 ? (
          testimonials.slice(0, 3).map((testimonial: any) => (
            <div class="card p-8">
              <div class="flex gap-1 mb-4">
                {[...Array(testimonial.rating || 5)].map(() => (
                  <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                  </svg>
                ))}
              </div>
              <p class="text-gray-600 mb-4">"{testimonial.content}"</p>
              <p class="font-semibold">- {testimonial.name}{testimonial.company ? `, ${testimonial.company}` : ''}</p>
            </div>
          ))
        ) : (
          <>
            <div class="card p-8">
              <div class="flex gap-1 mb-4">
                {[...Array(5)].map(() => (
                  <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                  </svg>
                ))}
              </div>
              <p class="text-gray-600 mb-4">
                "Excellent work on our kitchen remodel. Professional, on time, and within budget.
                Couldn't be happier with the results!"
              </p>
              <p class="font-semibold">- John & Sarah M.</p>
            </div>

            <div class="card p-8">
              <div class="flex gap-1 mb-4">
                {[...Array(5)].map(() => (
                  <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                  </svg>
                ))}
              </div>
              <p class="text-gray-600 mb-4">
                "Living Stone transformed our basement into a beautiful living space. The attention
                to detail was outstanding. Highly recommend!"
              </p>
              <p class="font-semibold">- Michael R.</p>
            </div>

            <div class="card p-8">
              <div class="flex gap-1 mb-4">
                {[...Array(5)].map(() => (
                  <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                  </svg>
                ))}
              </div>
              <p class="text-gray-600 mb-4">
                "New roof looks amazing and was completed ahead of schedule. The crew was
                respectful and cleaned up perfectly. Five stars!"
              </p>
              <p class="font-semibold">- Patricia L.</p>
            </div>
          </>
        )}
      </div>
    </div>
  </section>
</MainLayout>
